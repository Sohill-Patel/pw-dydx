LavaPack.loadBundle([[79,{"../../../../shared/modules/fetch-with-timeout":5015,"./resolver":78,"base32-encode":3422,"base64-js":3423,"webextension-polyfill":4941},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:n,getUseAddressBarEnsResolution:s}){const c=u.map((e=>`*://*.${e}/*`));return i.default.webRequest.onErrorOccurred.addListener(d,{urls:c,types:["main_frame"]}),{remove(){i.default.webRequest.onErrorOccurred.removeListener(d)}};async function d(c){const{tabId:d,url:f}=c;if(-1===d||"0x1"!==t())return;const{hostname:p,pathname:m,search:g,hash:h}=new URL(f),b=p.split("."),_=b[b.length-1];u.includes(_)&&async function({tabId:t,name:c,pathname:u,search:d,fragment:f}){const p=n(),m=s(),g=`https://app.ens.domains/name/${c}`;m&&p&&await i.default.tabs.update(t,{url:"loading.html"});let h=g;0;try{const{type:t,hash:n}=await(0,a.default)({provider:e,name:c});if("ipfs-ns"===t||"ipns-ns"===t){if(""===p)return void(h=null);const e=`https://${n}.${t.slice(0,4)}.${p}${u}${d||""}${f||""}`;try{200===(await l(e,{method:"HEAD"})).status&&(h=e)}catch(e){console.warn(e)}}else if("swarm-ns"===t)h=`https://swarm-gateways.net/bzz:/${n}${u}${d||""}${f||""}`;else if("onion"===t||"onion3"===t)h=`http://${n}.onion${u}${d||""}${f||""}`;else if("zeronet"===t)h=`http://127.0.0.1:43110/${n}${u}${d||""}${f||""}`;else if("skynet-ns"===t){const e=n.padEnd(n.length+4-n.length%4,"="),t=o.default.toByteArray(e),i={padding:!1};h=`https://${(0,r.default)(t,"RFC4648-HEX",i).toLowerCase()}.siasky.net${u}${d||""}${f||""}`}}catch(e){console.warn(e)}finally{h&&(m||!m&&h!==g)&&await i.default.tabs.update(t,{url:h})}}({tabId:d,name:p,pathname:m,search:g,fragment:h})}};var r=c(e("base32-encode")),o=c(e("base64-js")),i=c(e("webextension-polyfill")),s=c(e("../../../../shared/modules/fetch-with-timeout")),a=c(e("./resolver"));function c(e){return e&&e.__esModule?e:{default:e}}const l=(0,s.default)(),u=["eth"]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/setup.js"}],[8,{"../../../shared/constants/alerts":4961,"@metamask/obs-store":1782},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/obs-store"),o=e("../../../shared/constants/alerts");const i={alertEnabledness:o.TOGGLEABLE_ALERT_TYPES.reduce(((e,t)=>(e[t]=!0,e)),{}),unconnectedAccountAlertShownOrigins:{},web3ShimUsageOrigins:{}};n.default=class{constructor(e={}){const{initState:t={},controllerMessenger:n}=e,o={...i,alertEnabledness:{...i.alertEnabledness,...t.alertEnabledness}};this.store=new r.ObservableStore(o),this.controllerMessenger=n,this.selectedAddress=this.controllerMessenger.call("AccountsController:getSelectedAccount"),this.controllerMessenger.subscribe("AccountsController:selectedAccountChange",(e=>{this.store.getState().unconnectedAccountAlertShownOrigins&&this.selectedAddress!==e.address&&(this.selectedAddress=e.address,this.store.updateState({unconnectedAccountAlertShownOrigins:{}}))}))}setAlertEnabledness(e,t){let{alertEnabledness:n}=this.store.getState();n={...n},n[e]=t,this.store.updateState({alertEnabledness:n})}setUnconnectedAccountAlertShown(e){let{unconnectedAccountAlertShownOrigins:t}=this.store.getState();t={...t},t[e]=!0,this.store.updateState({unconnectedAccountAlertShownOrigins:t})}getWeb3ShimUsageState(e){return this.store.getState().web3ShimUsageOrigins[e]}setWeb3ShimUsageRecorded(e){this._setWeb3ShimUsageState(e,o.Web3ShimUsageAlertStates.recorded)}setWeb3ShimUsageAlertDismissed(e){this._setWeb3ShimUsageState(e,o.Web3ShimUsageAlertStates.dismissed)}_setWeb3ShimUsageState(e,t){let{web3ShimUsageOrigins:n}=this.store.getState();n={...n},n[e]=t,this.store.updateState({web3ShimUsageOrigins:n})}}}}},{package:"$root$",file:"app/scripts/controllers/alert.js"}],[82,{lodash:4322},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return o((0,r.cloneDeep)(e),(e=>null===e?"null":typeof e))};var r=e("lodash");function o(e={},t){return Object.entries(e).forEach((([n,r])=>{e[n]="object"==typeof r&&null!==r?o(r,t):t(r)})),e}}}},{package:"$root$",file:"app/scripts/lib/getObjStructure.js"}],[83,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hardwareKeyringBuilderFactory=function(e,t){const n=()=>new e({bridge:new t});return n.type=e.type,n}}}},{package:"$root$",file:"app/scripts/lib/hardware-keyring-builder-factory.ts"}],[86,{"../util":135,"json-rpc-engine":4166},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPendingNonceMiddleware=function({getPendingNonce:e}){return(0,r.createAsyncMiddleware)((async(t,n,r)=>{const{method:o,params:i}=t;if("eth_getTransactionCount"!==o)return void r();const[s,a]=i;"pending"===a?n.result=await e(s,t.networkClientId):r()}))},n.createPendingTxMiddleware=function({getPendingTransactionByHash:e}){return(0,r.createAsyncMiddleware)((async(t,n,r)=>{const{method:i,params:s}=t;if("eth_getTransactionByHash"!==i)return void r();const[a]=s,c=e(a);c?n.result=(0,o.formatTxMetaForRpcResult)(c):r()}))};var r=e("json-rpc-engine"),o=e("../util")}}},{package:"$root$",file:"app/scripts/lib/middleware/pending.js"}],[87,{events:3814,loglevel:4328},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e("events")),o=i(e("loglevel"));function i(e){return e&&e.__esModule?e:{default:e}}class s extends r.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort(((e,t)=>e.version-t.version));const n=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||n&&n.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter((function(t){return t.version>e.meta.version}));for(const n of t)try{o.default.info(`Running migration ${n.version}...`);const t=await n.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==n.version)throw new Error("Migrator - Migration did not update version number correctly");e=t,o.default.info(`Migration ${n.version} complete`)}catch(t){const r=t.message;return t.message=`MetaMask Migration Error #${n.version}: ${r}`,this.emit("error",t),e}return e}generateInitialState(e){return{meta:{version:this.defaultVersion},data:e}}}n.default=s}}},{package:"$root$",file:"app/scripts/lib/migrator/index.js"}],[9,{"@metamask/obs-store":1782,events:3814},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("events"))&&r.__esModule?r:{default:r},i=e("@metamask/obs-store");function s(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}const l={currentAppVersion:"",previousAppVersion:"",previousMigrationVersion:0,currentMigrationVersion:0};var u=new WeakSet,d=new WeakSet;class f extends o.default{constructor({currentAppVersion:e="",currentMigrationVersion:t=0,state:n={}}){super(),s(this,d),s(this,u),a(this,"store",void 0),this.store=new i.ObservableStore({...l,...n}),c(this,u,p).call(this,e),c(this,d,m).call(this,t)}}function p(e){const t=this.store.getState().currentAppVersion;e!==t&&this.store.updateState({currentAppVersion:e,previousAppVersion:t})}function m(e){const t=this.store.getState().currentMigrationVersion;e!==t&&this.store.updateState({previousMigrationVersion:t,currentMigrationVersion:e})}n.default=f}}},{package:"$root$",file:"app/scripts/controllers/app-metadata.ts"}],[90,{"../../../shared/constants/notifications":4978,"../platforms/extension":275,"@metamask/safe-event-emitter":1906},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.NOTIFICATION_MANAGER_EVENTS=void 0;var r=s(e("@metamask/safe-event-emitter")),o=s(e("../platforms/extension")),i=e("../../../shared/constants/notifications");function s(e){return e&&e.__esModule?e:{default:e}}const a=n.NOTIFICATION_MANAGER_EVENTS={POPUP_CLOSED:"onPopupClosed"};class c extends r.default{constructor(){super(),this.platform=new o.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(e,t){this._popupId=t,this._setCurrentPopupId=e;const n=await this._getPopup(t);if(n)await this.platform.focusWindow(n.id);else{let e=0,t=0;try{const n=await this.platform.getLastFocusedWindow();t=n.top,e=Math.max(n.left+(n.width-i.NOTIFICATION_WIDTH),0)}catch(n){const{screenX:r,screenY:o,outerWidth:s}=window;t=Math.max(o,0),e=Math.max(r+(s-i.NOTIFICATION_WIDTH),0)}const n=await this.platform.openWindow({url:"notification.html",type:"popup",width:i.NOTIFICATION_WIDTH,height:i.NOTIFICATION_HEIGHT,left:e,top:t});n.left!==e&&"fullscreen"!==n.state&&await this.platform.updateWindowPosition(n.id,e,t),this._setCurrentPopupId(n.id),this._popupId=n.id}}_onWindowClosed(e){e===this._popupId&&(this._setCurrentPopupId(undefined),this._popupId=undefined,this.emit(a.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find((e=>e&&"popup"===e.type&&e.id===this._popupId)):null}}n.default=c}}},{package:"$root$",file:"app/scripts/lib/notification-manager.js"}],[91,{"../../../../shared/constants/offscreen-communication":4979,"eth-lattice-keyring":3713},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LatticeKeyringOffscreen=void 0;var r,o=(r=e("eth-lattice-keyring"))&&r.__esModule?r:{default:r},i=e("../../../../shared/constants/offscreen-communication");class s extends o.default{constructor(e={}){super(e)}async _getCreds(){try{const e=this.appName?this.appName:"Unknown",t=`${i.KnownOrigins.lattice}?keyring=${e}&forceLogin=true`;return await new Promise(((e,n)=>{chrome.runtime.sendMessage({target:i.OffscreenCommunicationTarget.latticeOffscreen,params:{url:t}},(t=>{t.error&&n(t.error),e(t.result)}))}))}catch(e){throw new Error(e)}}}n.LatticeKeyringOffscreen=s,function(e,t,n){(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(s,"type",void 0),s.type=o.default.type}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/lattice-offscreen-keyring.ts"}],[92,{"../../../../shared/constants/offscreen-communication":4979},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerOffscreenBridge=void 0;var r=e("../../../../shared/constants/offscreen-communication");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.LedgerOffscreenBridge=class{constructor(){o(this,"isDeviceConnected",!1)}init(){return chrome.runtime.onMessage.addListener((e=>{e.target===r.OffscreenCommunicationTarget.extension&&e.event===r.OffscreenCommunicationEvents.ledgerDeviceConnect&&(this.isDeviceConnected=!0)})),Promise.resolve()}destroy(){return Promise.resolve()}attemptMakeApp(){return new Promise(((e,t)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.makeApp},(n=>{n.success?e(!0):n.error?t(n.error):t(new Error("Unknown error occurred"))}))}))}updateTransportMethod(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.updateTransport,params:{transportType:e}},(e=>{e.success?t(!0):n(new Error("Ledger transport could not be updated"))}))}))}getPublicKey(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.getPublicKey,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}deviceSignTransaction(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.signTransaction,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}deviceSignMessage(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.signPersonalMessage,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}deviceSignTypedData(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.signTypedData,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/ledger-offscreen-bridge.ts"}],[93,{"../../../../shared/constants/offscreen-communication":4979},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TrezorOffscreenBridge=void 0;var r=e("../../../../shared/constants/offscreen-communication");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.TrezorOffscreenBridge=class{constructor(){o(this,"model",void 0)}init(e){return chrome.runtime.onMessage.addListener((e=>{e.target===r.OffscreenCommunicationTarget.extension&&e.event===r.OffscreenCommunicationEvents.trezorDeviceConnect&&(this.model=e.payload)})),new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.init,params:e},(()=>{t()}))}))}dispose(){return new Promise((e=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.dispose},(()=>{e()}))}))}getPublicKey(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.getPublicKey,params:e},(e=>{t(e)}))}))}ethereumSignTransaction(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signTransaction,params:e},(e=>{t(e)}))}))}ethereumSignMessage(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signMessage,params:e},(e=>{t(e)}))}))}ethereumSignTypedData(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signTypedData,params:e},(e=>{t(e)}))}))}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/trezor-offscreen-bridge.ts"}],[94,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IndexedDBPPOMStorage=void 0;const i=async(e,t,n)=>{const r=await crypto.subtle.digest("SHA-256",t);if(Array.from(new Uint8Array(r)).map((e=>e.toString(16).padStart(2,"0"))).join("")!==n)throw new Error(`Checksum mismatch for key ${e}`)};var s=new WeakSet;function a(e){return new Promise(((t,n)=>{const r=indexedDB.open(this.storeName,this.dbVersion);r.onerror=e=>{var t;n(new Error(`Failed to open database ${this.storeName}: ${null===(t=e.target)||void 0===t?void 0:t.error}`))},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:["name","chainId"]})},r.onsuccess=n=>{const r=n.target.result.transaction([this.storeName],e).objectStore(this.storeName);t(r)}}))}n.IndexedDBPPOMStorage=class{constructor(e,t){r(this,s),o(this,"storeName",void 0),o(this,"dbVersion",void 0),this.storeName=e,this.dbVersion=t}async objectStoreAction(e,t,n="readonly"){return new Promise(((r,o)=>{(function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n})(this,s,a).call(this,n).then((n=>{const i=n[e](t);i.onsuccess=async e=>{r(e)},i.onerror=t=>{var n;o(new Error(`Error in indexDB operation ${e}: ${null===(n=t.target)||void 0===n?void 0:n.error}`))}})).catch((e=>{o(e)}))}))}async read(e,t){var n;const r=null===(n=(await this.objectStoreAction("get",[e.name,e.chainId])).target)||void 0===n||null===(n=n.result)||void 0===n?void 0:n.data;return await i(e,r,t),r}async write(e,t,n){await i(e,t,n),await this.objectStoreAction("put",{...e,data:t},"readwrite")}async delete(e){await this.objectStoreAction("delete",[e.name,e.chainId],"readwrite")}async dir(){var e;return null===(e=(await this.objectStoreAction("getAllKeys")).target)||void 0===e?void 0:e.result.map((([e,t])=>({name:e,chainId:t})))}}}}},{package:"$root$",file:"app/scripts/lib/ppom/indexed-db-backend.ts"}],[95,{"../../../../shared/constants/security-provider":4983,"../../../../shared/constants/transaction":4990,"./ppom-util":96,"@metamask/controller-utils":1245},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPPOMMiddleware=function(e,t,n,c,l){return async(u,d,f)=>{try{var p,m;const d=null===(p=t.store.getState())||void 0===p?void 0:p.securityAlertsEnabled,{chainId:f}=n.state.providerConfig;if(!d||!a.includes(u.method)||!i.SECURITY_PROVIDER_SUPPORTED_CHAIN_IDS.includes(f))return;const{isSIWEMessage:g}=(0,r.detectSIWE)({data:null==u||null===(m=u.params)||void 0===m?void 0:m[0]});if(g)return;const h=(0,s.generateSecurityAlertId)();(0,s.validateRequestWithPPOM)({ppomController:e,request:u,securityAlertId:h,chainId:f}).then((e=>{l(u.method,h,e)}));const b={...i.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:h};o.SIGNING_METHODS.includes(u.method)&&c.addSignatureSecurityAlertResponse(b),u.securityAlertResponse=b}catch(e){u.securityAlertResponse=(0,s.handlePPOMError)(e,"Error createPPOMMiddleware: ")}finally{f()}}};var r=e("@metamask/controller-utils"),o=e("../../../../shared/constants/transaction"),i=e("../../../../shared/constants/security-provider"),s=e("./ppom-util");const a=Object.freeze(["eth_sendRawTransaction","eth_sendTransaction",...o.SIGNING_METHODS])}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-middleware.ts"}],[96,{"../../../../shared/constants/security-provider":4983,"../../../../shared/constants/transaction":4990,"./security-alerts-api":98,"@metamask/transaction-controller":2660,uuid:4893},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.generateSecurityAlertId=function(){return(0,o.v4)()},n.handlePPOMError=d,n.updateSecurityAlertResponse=async function({appStateController:e,method:t,securityAlertId:n,securityAlertResponse:r,signatureController:o,transactionController:i}){const a=s.SIGNING_METHODS.includes(t),c=await async function(e,t,n,r){const o=s.SIGNING_METHODS.includes(t);for(;;){let t;if(t=o?Object.values(n.messages).find((t=>{var n;return(null===(n=t.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===e})):r.state.transactions.find((t=>{var n;return(null===(n=t.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===e})),t)return t;await new Promise((e=>setTimeout(e,100)))}}(n,t,o,i);a?e.addSignatureSecurityAlertResponse(r):i.updateSecurityAlertResponse(c.id,r)},n.validateRequestWithPPOM=async function({ppomController:e,request:t,securityAlertId:n,chainId:o}){try{const s=function(e){if(t=e,t.method!==l)return e;var t;const n=e.params[0],o=(0,r.normalizeTransactionParams)(n);return{...e,params:[o]}}(t),c=(0,a.isSecurityAlertsAPIEnabled)()?await async function(e,t,n){try{return{...await(0,a.validateWithSecurityAlertsAPI)(t,n),source:i.SecurityAlertSource.API}}catch(t){return d(t,"Error validating request with security alerts API"),await f(e,n)}}(e,o,s):await f(e,s);return{...c,securityAlertId:n}}catch(e){return d(e,"Error validating JSON RPC using PPOM: ")}};var r=e("@metamask/transaction-controller"),o=e("uuid"),i=e("../../../../shared/constants/security-provider"),s=e("../../../../shared/constants/transaction"),a=e("./security-alerts-api");const{sentry:c}=global,l="eth_sendTransaction",u={result_type:i.BlockaidResultType.Errored,reason:i.BlockaidReason.errored};function d(e,t){const n=function(e){if("object"==typeof e||"string"==typeof e)return e;return JSON.stringify(e)}(e),r=function(e){if(e instanceof Error)return`${e.name}: ${e.message}`;return JSON.stringify(e)}(e);return null==c||c.captureException(e),console.error(t,n),{...u,description:r}}async function f(e,t){return{...await e.usePPOM((e=>e.validateJsonRpc(t))),source:i.SecurityAlertSource.Local}}}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-util.ts"}],[97,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){let r;Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.PPOM=void 0,n.initSync=function(e){if(r!==undefined)return r;const t=O();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));const n=new WebAssembly.Instance(e,t);return M(n,e)},n.main=function(){r.main()};const o="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&o.decode();let i=null;function s(){return null!==i&&0!==i.byteLength||(i=new Uint8Array(r.memory.buffer)),i}function a(e,t){return e>>>=0,o.decode(s().subarray(e,e+t))}const c=new Array(128).fill(undefined);c.push(undefined,null,!0,!1);let l=c.length;function u(e){l===c.length&&c.push(c.length+1);const t=l;return l=c[t],c[t]=e,t}function d(e){return c[e]}function f(e){const t=d(e);return function(e){e<132||(c[e]=l,l=e)}(e),t}let p=0;const m="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},g="function"==typeof m.encodeInto?function(e,t){return m.encodeInto(e,t)}:function(e,t){const n=m.encode(e);return t.set(n),{read:e.length,written:n.length}};function h(e,t,n){if(n===undefined){const n=m.encode(e),r=t(n.length,1)>>>0;return s().subarray(r,r+n.length).set(n),p=n.length,r}let r=e.length,o=t(r,1)>>>0;const i=s();let a=0;for(;a<r;a++){const t=e.charCodeAt(a);if(t>127)break;i[o+a]=t}if(a!==r){0!==a&&(e=e.slice(a)),o=n(o,r,r=a+3*e.length,1)>>>0;const t=s().subarray(o+a,o+r);a+=g(e,t).written}return p=a,o}let b=null;function _(){return null!==b&&0!==b.byteLength||(b=new Int32Array(r.memory.buffer)),b}function w(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=w(e[0]));for(let r=1;r<t;r++)n+=", "+w(e[r]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(!(n.length>1))return toString.call(e);if(r=n[1],"Object"==r)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:r}function y(e,t,n){r.wasm_bindgen__convert__closures__invoke1_mut(e,t,u(n))}function v(e,t){r._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__destroy(e,t)}let E=null;function T(e,t){const n=t(4*e.length,4)>>>0,o=(null!==E&&0!==E.byteLength||(E=new Uint32Array(r.memory.buffer)),E);for(let t=0;t<e.length;t++)o[n/4+t]=u(e[t]);return p=e.length,n}function S(e,t){try{return e.apply(this,t)}catch(e){r.__wbindgen_exn_store(u(e))}}class A{static __wrap(e){e>>>=0;const t=Object.create(A.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_ppom_free(e)}static new(e,t){const n=T(t,r.__wbindgen_malloc),o=p;return f(r.ppom_new(u(e),n,o))}validateJsonRpc(e){return f(r.ppom_validateJsonRpc(this.__wbg_ptr,u(e)))}static version(){return f(r.ppom_version())}}function O(){const e={wbg:{}};return e.wbg.__wbg_buffer_085ec1f694018c4f=function(e){return u(d(e).buffer)},e.wbg.__wbg_call_01734de55d61e11d=function(){return S((function(e,t,n){return u(d(e).call(d(t),d(n)))}),arguments)},e.wbg.__wbg_call_4c92f6aec1e1d6e6=function(){return S((function(e,t,n,r){return u(d(e).call(d(t),d(n),d(r)))}),arguments)},e.wbg.__wbg_from_d7c216d4616bb368=function(e){return u(Array.from(d(e)))},e.wbg.__wbg_get_44be0491f933a435=function(e,t){return u(d(e)[t>>>0])},e.wbg.__wbg_length_72e2208bbc0efc61=function(e){return d(e).length},e.wbg.__wbg_length_d813e535247d427e=function(e){return d(e).length},e.wbg.__wbg_length_fff51ee6522a1a18=function(e){return d(e).length},e.wbg.__wbg_new_43f1b47c28813cbd=function(e,t){try{var n={a:e,b:t};const o=new Promise(((e,t)=>{const o=n.a;n.a=0;try{return function(e,t,n,o){r.wasm_bindgen__convert__closures__invoke2_mut(e,t,u(n),u(o))}(o,n.b,e,t)}finally{n.a=o}}));return u(o)}finally{n.a=n.b=0}},e.wbg.__wbg_new_8125e318e6245eed=function(e){return u(new Uint8Array(d(e)))},e.wbg.__wbg_parse_670c19d4e984792e=function(){return S((function(e,t){return u(JSON.parse(a(e,t)))}),arguments)},e.wbg.__wbg_ppom_new=function(e){return u(A.__wrap(e))},e.wbg.__wbg_resolve_53698b95aaf7fcf8=function(e){return u(Promise.resolve(d(e)))},e.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){d(e).set(d(t),n>>>0)},e.wbg.__wbg_stringify_e25465938f3f611f=function(){return S((function(e){return u(JSON.stringify(d(e)))}),arguments)},e.wbg.__wbg_then_b2267541e2a73865=function(e,t,n){return u(d(e).then(d(t),d(n)))},e.wbg.__wbg_then_f7e06ee3c11698eb=function(e,t){return u(d(e).then(d(t)))},e.wbg.__wbindgen_cb_drop=function(e){const t=f(e).original;if(1==t.cnt--)return t.a=0,!0;return!1},e.wbg.__wbindgen_closure_wrapper_wasm_bindgen__closure__Closure_T___wrap__breaks_if_inlined=function(e,t,n){const r=function(e,t,n,r){const o={a:e,b:t,cnt:1},i=(...e)=>{o.cnt++;const t=o.a;o.a=0;try{return r(t,o.b,...e)}finally{0==--o.cnt?n(t,o.b):o.a=t}};return i.original=o,i}(e,t,v,y);return u(r)},e.wbg.__wbindgen_debug_string=function(e,t){const n=h(w(d(t)),r.__wbindgen_malloc,r.__wbindgen_realloc),o=p;_()[e/4+1]=o,_()[e/4+0]=n},e.wbg.__wbindgen_error_new=function(e,t){return u(new Error(a(e,t)))},e.wbg.__wbindgen_is_undefined=function(e){return d(e)===undefined},e.wbg.__wbindgen_memory=function(){return u(r.memory)},e.wbg.__wbindgen_object_drop_ref=function(e){f(e)},e.wbg.__wbindgen_string_get=function(e,t){const n=d(t),o="string"==typeof n?n:undefined;var i,s=(i=o)===undefined||null===i?0:h(o,r.__wbindgen_malloc,r.__wbindgen_realloc),a=p;_()[e/4+1]=a,_()[e/4+0]=s},e.wbg.__wbindgen_string_new=function(e,t){return u(a(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(a(e,t))},e}function M(e,t){return r=e.exports,P.__wbindgen_wasm_module=t,b=null,E=null,i=null,r.__wbindgen_start(),r}async function P(e){if(r!==undefined)return r;const t=O();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:o}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return M(n,o)}n.PPOM=A;n.default=P}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom.js"}],[98,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isSecurityAlertsAPIEnabled=function(){return"true"==="".toString()},n.validateWithSecurityAlertsAPI=async function(e,t){return async function(e,t){const n=function(e){const t="http://localhost:3000";if(!t)throw new Error("Security alerts API URL is not set");return`${t}/${e}`}(e),r=await fetch(n,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Security alerts API request failed with status: ${r.status}`);return r.json()}(`${r}/${e}`,t)};const r="validate"}}},{package:"$root$",file:"app/scripts/lib/ppom/security-alerts-api.ts"}],[99,{"./handlers":105,"@metamask/permission-controller":1796,"@metamask/snaps-rpc-methods":2467,"@metamask/utils":2739,"eth-rpc-errors":3745},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createMethodMiddleware=n.createLegacyMethodMiddleware=void 0;var r=e("@metamask/permission-controller"),o=e("@metamask/snaps-rpc-methods"),i=e("@metamask/utils"),s=e("eth-rpc-errors"),a=e("./handlers");const c=[...a.handlers,...r.permissionRpcMethods.handlers];n.createMethodMiddleware=l(c),n.createLegacyMethodMiddleware=l(a.legacyHandlers);function l(e){const t=e.reduce(((e,t)=>{for(const n of t.methodNames)e[n]=t;return e}),{}),n=new Set(e.flatMap((({hookNames:e})=>Object.getOwnPropertyNames(e))));return e=>{!function(e,t){const n=[];if(t.forEach((t=>{(0,i.hasProperty)(e,t)||n.push(t)})),n.length>0)throw new Error(`Missing expected hooks:\n\n${n.join("\n")}\n`);const r=Object.getOwnPropertyNames(e).filter((e=>!t.has(e)));if(r.length>0)throw new Error(`Received unexpected hooks:\n\n${r.join("\n")}\n`)}(e,n);return async(n,r,i,a)=>{const c=t[n.method];if(c){const{implementation:t,hookNames:l}=c;try{return await t(n,r,i,a,(0,o.selectHooks)(e,l))}catch(e){return a(e instanceof Error?e:s.ethErrors.rpc.internal({data:e}))}}return i()}}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createMethodMiddleware.js"}],[4,{"../../shared/constants/app":4962,"../../shared/constants/metametrics":4973,"../../shared/constants/offscreen-communication":4979,"../../shared/modules/browser-runtime.utils":5006,"../../shared/modules/mv3.utils":5020,"../../shared/modules/object.utils":5022,"../../test/e2e/default-fixture":5036,"./constants/sentry-state":6,"./controllers/metamask-notifications/constants/notification-schema":18,"./first-time-state":53,"./lib/createStreamSink":73,"./lib/ens-ipfs/setup":79,"./lib/get-first-preferred-lang-code":81,"./lib/getObjStructure":82,"./lib/local-store":84,"./lib/migrator":87,"./lib/network-store":89,"./lib/notification-manager":90,"./lib/setup-initial-state-hooks":115,"./lib/util":135,"./metamask-controller":136,"./migrations":273,"./offscreen":274,"./platforms/extension":275,"./skip-onboarding":276,"@metamask/controller-utils":1245,"@metamask/obs-store":1782,"@metamask/utils":2739,"debounce-stream":3662,"eth-rpc-errors":3745,events:3814,"extension-port-stream":3817,loglevel:4328,"readable-stream":4734,"webextension-polyfill":4941},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.loadStateFromPersistence=he,n.setupController=we,n.statePersistenceEvents=void 0,e("./lib/setup-initial-state-hooks");var r=$(e("events")),o=e("readable-stream"),i=$(e("debounce-stream")),s=$(e("loglevel")),a=$(e("webextension-polyfill")),c=e("@metamask/obs-store"),l=e("@metamask/utils"),u=e("@metamask/controller-utils"),d=$(e("extension-port-stream")),f=e("eth-rpc-errors"),p=e("../../shared/constants/app"),m=e("../../shared/constants/metametrics"),g=e("../../shared/modules/browser-runtime.utils"),h=e("../../shared/modules/mv3.utils"),b=e("../../shared/modules/object.utils"),_=(e("../../test/e2e/default-fixture"),e("../../shared/constants/offscreen-communication"),$(e("./migrations"))),w=$(e("./lib/migrator")),y=$(e("./platforms/extension")),v=$(e("./lib/local-store")),E=$(e("./lib/network-store")),T=e("./constants/sentry-state"),S=$(e("./lib/createStreamSink")),A=L(e("./lib/notification-manager")),O=L(e("./metamask-controller")),M=$(e("./first-time-state")),P=$(e("./lib/get-first-preferred-lang-code")),C=$(e("./lib/getObjStructure")),N=$(e("./lib/ens-ipfs/setup")),I=e("./lib/util"),k=(e("./skip-onboarding"),e("./offscreen")),R=e("./controllers/metamask-notifications/constants/notification-schema");function j(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(j=function(e){return e?n:t})(e)}function L(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=j(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}function $(e){return e&&e.__esModule?e:{default:e}}const U="#0376C9",D="#D73847",x=9,F=!1,V=F?new E.default:new v.default;global.stateHooks.getMostRecentPersistedState=()=>V.mostRecentRetrievedState;const{sentry:B}=global;let W={...M.default};const G={[p.ENVIRONMENT_TYPE_POPUP]:!0,[p.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[p.ENVIRONMENT_TYPE_FULLSCREEN]:!0},z=["trezor-connect"];s.default.setLevel("info",!1);const H=new y.default,K=new A.default;let Y=0,q=!1,J=!1;const Q={},X={};let Z,ee;const te={};F&&(global.stateHooks.metamaskGetState=V.get.bind(V));const ne=new URL("https://metamask.github.io/phishing-warning/v3.0.3/"),re=ne.toString(),oe=1e3,ie=n.statePersistenceEvents=new r.default,{promise:se,resolve:ae,reject:ce}=(0,I.deferredPromise)(),le=async()=>{const e=await a.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then((e=>((0,g.checkForLastErrorAndLog)(),e))).catch((()=>{(0,g.checkForLastErrorAndLog)()}));for(const t of e)a.default.tabs.sendMessage(t.id,{name:p.EXTENSION_MESSAGES.READY}).then((()=>{(0,g.checkForLastErrorAndLog)()})).catch((()=>{(0,g.checkForLastErrorAndLog)()}))};let ue,de,fe;function pe(){const e=(new Date).toISOString();a.default.storage.session.set({timestamp:e})}async function me(){try{const t=h.isManifestV3?(0,k.createOffscreen)():null,n=await he(),r=n.data,o=await(0,P.default)();let i;if(h.isManifestV3){var e;if(!1!==(null===(e=r.PreferencesController)||void 0===e?void 0:e.enableMV3TimestampSave)){const e=2e3;pe(),setInterval(pe,e)}const t=await a.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);i=(null==t?void 0:t.isFirstMetaMaskControllerSetup)===undefined,await a.default.storage.session.set({isFirstMetaMaskControllerSetup:i})}we(r,o,{},i,n.meta,t),function(e){async function t(e,t){try{return await a.default.tabs.update(e,{url:t})}catch(e){return null==B?void 0:B.captureException(e)}}const n=!h.isManifestV3;a.default.webRequest.onBeforeRequest.addListener((r=>{if(r.tabId===a.default.tabs.TAB_ID_NONE)return{};if(!e.onboardingController.store.getState().completedOnboarding)return{};if(!e.preferencesController.store.getState().usePhishDetect)return{};if(r.initiator&&new URL(r.initiator).host===ne.host)return{};const{hostname:o,href:i,searchParams:s}=new URL(r.url);if(F&&s.has("IN_TEST_BYPASS_EARLY_PHISHING_DETECTION"))return{};e.phishingController.maybeUpdateState();const c=e.phishingController.test(o);if(null==c||!c.result)return{};e.metaMetricsController.trackEvent({event:m.MetaMetricsEventName.PhishingPageDisplayed,category:m.MetaMetricsEventCategory.Phishing,properties:{url:o}});const l=new URLSearchParams({hostname:o,href:i}),u=new URL(re);u.hash=l.toString();const d=u.toString();return n?"sub_frame"===r.type?(t(r.tabId,d),{cancel:!0}):{redirectUrl:d}:(t(r.tabId,d),{})}),{types:["main_frame","sub_frame"],urls:["http://*/*","https://*/*"]},n?["blocking"]:[])}(Z),h.isManifestV3||await async function(){let e;try{const t=new URL(re);let n,r;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const o=new Promise(((e,t)=>{n=e,r=t}));e.addEventListener("load",n),window.document.body.appendChild(e),setTimeout((()=>r(new ge)),oe),await o}catch(e){e instanceof ge?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await le(),s.default.info("MetaMask initialization complete."),ae()}catch(e){ce(e)}}a.default.runtime.onConnect.addListener((async(...e)=>{await se,ue(...e)})),a.default.runtime.onConnectExternal.addListener((async(...e)=>{var t;await se;null!==(t=e[0].sender.tab)&&void 0!==t&&t.id,de(...e)}));class ge extends Error{constructor(){super("Timeout failed")}}async function he(){const e=new w.default({migrations:_.default,defaultVersion:null});if(e.on("error",console.warn),ee=await V.get()||e.generateInitialState(W),ee&&!ee.data&&(ee=e.generateInitialState(W),B.captureMessage("MetaMask - Empty vault found - unable to recover")),e.on("error",(e=>{const t=(0,C.default)(ee);B.captureException(e,{extra:{vaultStructure:t}})})),ee=await e.migrateData(ee),!ee)throw new Error("MetaMask - migrator returned undefined");if(!(0,l.isObject)(ee.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof ee.meta}'`);if("number"!=typeof ee.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof ee.meta.version}'`);if(!(0,l.isObject)(ee.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof ee.data}'`);return V.setMetadata(ee.meta),V.set(ee.data),ee}function be(e){var t;const{metaMetricsId:n}=Z.metaMetricsController.state;if(!(0,I.shouldEmitDappViewedEvent)(n))return;const r=Z.controllerMessenger.call("PermissionController:getPermissions",e),o=null==r||null===(t=r.eth_accounts)||void 0===t||null===(t=t.caveats[0])||void 0===t?void 0:t.value.length;if(!o)return;const i=Z.controllerMessenger.call("PreferencesController:getState"),s=Object.keys(i.identities).length;Z.metaMetricsController.trackEvent({event:m.MetaMetricsEventName.DappViewed,category:m.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:s,number_of_accounts_connected:o}})}function _e(e){if(!e.sender||!e.sender.tab||!e.sender.url)return;const t=e.sender.tab.id,n=new URL(e.sender.url),{origin:r}=n;Object.keys(te).includes(t)||(te[t]=r);const o=Z.controllerMessenger.call("PermissionController:hasPermissions",r),i="New Tab"!==e.sender.tab.title;o&&i&&be(r)}function we(e,t,n,r,l,g){var _;Z=new O.default({infuraProjectId:"b6bf7d3508c941499b10025c0776eaf8",showUserConfirmation:ye,initState:e,initLangCode:t,platform:H,notificationManager:K,browser:a.default,getRequestAccountTabIds:()=>X,getOpenMetamaskTabsIds:()=>Q,localStore:V,overrides:n,isFirstMetaMaskControllerSetup:r,currentMigrationVersion:l.version,featureFlags:{},offscreenPromise:g}),(0,N.default)({getCurrentChainId:()=>Z.networkController.state.providerConfig.chainId,getIpfsGateway:Z.preferencesController.getIpfsGateway.bind(Z.preferencesController),getUseAddressBarEnsResolution:()=>Z.preferencesController.store.getState().useAddressBarEnsResolution,provider:Z.provider}),(0,o.pipeline)((0,c.storeAsStream)(Z.store),(0,i.default)(1e3),(0,S.default)((async e=>{await V.set(e),ie.emit("state-persisted",e)})),(e=>{s.default.error("MetaMask - Persistence pipeline failed",e)})),_=Z,global.stateHooks.getSentryAppState=function(){const e=_.memStore.getState();return(0,b.maskObject)(e,T.SENTRY_BACKGROUND_STATE)};const w=()=>Y>0||Boolean(Object.keys(Q).length)||q,y=(e,t)=>{if(!1===e)Z.onClientClosed();else{if(t===p.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(Q).length))return;Z.onEnvironmentTypeClosed(t)}};function v(e,t){return e>t?`${t}+`:String(e)}function E(){const e=M(),t=function(){try{const{isMetamaskNotificationsEnabled:e,isFeatureAnnouncementsEnabled:t}=Z.metamaskNotificationsController.state,n=Object.values(Z.notificationController.state.notifications).filter((e=>null===e.readDate)).length,r=t?Z.metamaskNotificationsController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type===R.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT)).length:0,o=e?Z.metamaskNotificationsController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type!==R.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT)).length:0;return n+r+o}catch(e){return console.error("Failed to get unread notifications count:",e),0}}();let n="",r=U;e?n=v(e,x):t>0&&(n=v(t,x),r=D);try{const e={text:n},t={color:r};h.isManifestV3?(a.default.action.setBadgeText(e),a.default.action.setBadgeBackgroundColor(t)):(a.default.browserAction.setBadgeText(e),a.default.browserAction.setBadgeBackgroundColor(t))}catch(e){console.error("Error updating browser badge:",e)}}function M(){try{let e=Z.appStateController.waitingForUnlock.length+Z.approvalController.getTotalApprovalCount();return Z.preferencesController.getUseRequestQueue()&&(e+=Z.queuedRequestController.state.queuedRequestCount),e}catch(e){return console.error("Failed to get pending approval count:",e),0}}ue=async e=>{var t;const r=e.name;if(z.includes(e.name))return;let i=!1;const s=(0,I.getPlatform)(),c=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(i=s===p.PLATFORM_FIREFOX?G[r]:(null==c?void 0:c.origin)===`chrome-extension://${a.default.runtime.id}`,i){var l;const t=(null==n||null===(l=n.getPortStream)||void 0===l?void 0:l.call(n,e))||new d.default(e);if(Z.isClientOpen=!0,Z.setupTrustedCommunication(t,e.sender),r===p.ENVIRONMENT_TYPE_POPUP&&(Y+=1,(0,o.finished)(t,(()=>{Y-=1;const e=w();Z.isClientOpen=e,y(e,p.ENVIRONMENT_TYPE_POPUP)}))),r===p.ENVIRONMENT_TYPE_NOTIFICATION&&(q=!0,(0,o.finished)(t,(()=>{q=!1;const e=w();Z.isClientOpen=e,y(e,p.ENVIRONMENT_TYPE_NOTIFICATION)}))),r===p.ENVIRONMENT_TYPE_FULLSCREEN){const n=e.sender.tab.id;Q[n]=!0,(0,o.finished)(t,(()=>{delete Q[n];const e=w();Z.isClientOpen=e,y(e,p.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(c&&c.origin===ne.origin&&c.pathname===ne.pathname){var u;const t=(null==n||null===(u=n.getPortStream)||void 0===u?void 0:u.call(n,e))||new d.default(e);Z.setupPhishingCommunication({connectionStream:t})}else{if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,n=new URL(e.sender.url),{origin:r}=n;_e(e),e.onMessage.addListener((e=>{e.data&&e.data.method===p.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&(X[r]=t)}))}de(e)}},de=e=>{var t;const r=(null==n||null===(t=n.getPortStream)||void 0===t?void 0:t.call(n,e))||new d.default(e);Z.setupUntrustedCommunicationEip1193({connectionStream:r,sender:e.sender})},fe=async e=>{var t;if(z.includes(e.name))return;e.sender&&e.sender.tab&&e.sender.url&&_e(e);const r=(null==n||null===(t=n.getPortStream)||void 0===t?void 0:t.call(n,e))||new d.default(e);Z.setupUntrustedCommunicationCaip({connectionStream:r,sender:e.sender})},null!=n&&n.registerConnectListeners&&n.registerConnectListeners(ue,de),E(),Z.decryptMessageController.hub.on(O.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,E),Z.encryptionPublicKeyController.hub.on(O.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,E),Z.signatureController.hub.on(O.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,E),Z.appStateController.on(O.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,E),Z.controllerMessenger.subscribe(O.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,E),Z.controllerMessenger.subscribe(O.METAMASK_CONTROLLER_EVENTS.QUEUED_REQUEST_STATE_CHANGE,E),Z.controllerMessenger.subscribe(O.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_LIST_UPDATED,E),Z.controllerMessenger.subscribe(O.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_MARK_AS_READ,E),Z.controllerMessenger.subscribe(O.METAMASK_CONTROLLER_EVENTS.NOTIFICATIONS_STATE_CHANGE,E),Z.txController.initApprovals(),K.on(A.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{e?M()>0&&ye():(Z.signatureController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE_SIG),Z.decryptMessageController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE),Z.encryptionPublicKeyController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE),Object.values(Z.approvalController.state.pendingApprovals).forEach((({id:e,type:t})=>{switch(t){case u.ApprovalType.SnapDialogAlert:case u.ApprovalType.SnapDialogPrompt:Z.approvalController.accept(e,null);break;case u.ApprovalType.SnapDialogConfirmation:case p.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation:case p.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval:case p.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect:Z.approvalController.accept(e,!1);break;default:Z.approvalController.reject(e,f.ethErrors.provider.userRejectedRequest())}}))),E()})),Object.values(Z.snapController.state.snaps).some((e=>!e.preinstalled))&&Z.snapController.updateBlockedSnaps()}async function ye(){const e=await H.getActiveTabs(),t=Boolean(e.find((e=>Q[e.id]))),n=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!J&&(n||0===Y)&&!t){J=!0;try{const e=Z.appStateController.getCurrentPopupId();await K.showPopup((e=>Z.appStateController.setCurrentPopupId(e)),e)}finally{J=!1}}}const ve=()=>{if(Z)return Z.metaMetricsController.updateTraits({[m.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void Z.metaMetricsController.addEventBeforeMetricsOptIn({category:m.MetaMetricsEventCategory.App,event:m.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout((()=>{ve()}),500)};async function Ee(){Boolean(await V.get())||(ve(),H.openExtensionInBrowser()),a.default.tabs.onActivated.addListener((e=>{if(Z){const{tabId:t}=e,n=te[t];n&&Z.permissionController.state.subjects[n]!==undefined&&be(n)}}))}(async function(){await Ee();try{await me()}catch(e){s.default.error(e)}})()}}},{package:"$root$",file:"app/scripts/background.js"}]],[4],{});